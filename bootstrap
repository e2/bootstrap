#!/bin/sh

set -e

GIT_DIR="${HOME}/git"
BOOTSTRAP_DIR="${GIT_DIR}/bootstrap"

if [ -d "${BOOTSTRAP_DIR}/.git" ]; then
  if [ ! "$1" = "NOUPDATE" ]; then
    echo Bootstrap repos exists. Updating...
    cd "${BOOTSTRAP_DIR}"
    if git pull | grep -w bootstrap; then
      echo Bootstrap might have been modified.
      echo Restarting...
      "${BOOTSTRAP_DIR}/bootstrap NOUPDATE"
    fi
  fi
else
  echo No bootstrap repo, downloading from github...
  mkdir -p "${GIT_DIR}"
  cd "${GIT_DIR}"
  git clone git://github.com/e2/bootstrap.git
  cd "${BOOTSTRAP_DIR}"
  exit
fi

zsh bootstrap2.sh
